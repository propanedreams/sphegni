---
import Base from "../../layouts/Base.astro";
import { getCollection, getEntry } from "astro:content";

export async function getStaticPaths() {
  const items = await getCollection("cases");
  return items.map(({ slug }) => ({ params: { slug } }));
}

const { slug } = Astro.params;
const entry = await getEntry({ collection: "cases", slug });
const rendered = entry ? await entry.render() : null;
const Content = rendered?.Content;

const pageTitle = entry ? `${entry.data.title} – Case` : "Case not found";
const pageDesc = entry ? entry.data.summary : "The requested case does not exist.";
---
<Base title={pageTitle} description={pageDesc}>
  <div class="mx-auto max-w-6xl px-4 py-12 md:py-16">
    {!entry ? (
      <div>
        <h1 class="text-2xl font-bold">Case not found</h1>
        <p class="mt-2"><a class="underline" href="/cases">← Back to all cases</a></p>
      </div>
    ) : (
      <article class="space-y-4">
        <h1 class="text-3xl font-bold">{entry.data.title}</h1>
        {entry.data.cover && (
          <img
            src={entry.data.cover}
            alt={entry.data.title}
            class="w-full rounded-xl border"
            loading="lazy"
          />
        )}
        <p class="text-slate-600">
          {entry.data.location}{entry.data.year ? ` • ${entry.data.year}` : ""}
        </p>
        {Content && <Content />}
        <p class="mt-6"><a class="underline" href="/cases">← Back to all cases</a></p>
      </article>
    )}
  </div>
</Base>
